
{% extends "base.html" %}
{% block content %}
<div class="row justify-content-center">
  <div class="col-12 col-sm-10 col-md-6 col-lg-4">
    <div class="card shadow-sm">
      <div class="card-body">
        <h1 class="h4 mb-3">{{ _('Login') }}</h1>

        <form method="post" action="{{ url_for('auth_routes.login') }}">
          <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
          
          <!--div class="mb-3">
            <label class="form-label">{{ _('Benutzername') }}</label>
            <input id="login_username" name="username" class="form-control" autocomplete="username" required>
          </div-->
          <div class="input-group mb-3">
            <span class="input-group-text"><i class="bi bi-person"></i></span>
            <div class="form-floating flex-grow-1">
              <input id="login_username" name="username" type="text" class="form-control" required>
              <label for="vollgut">{{ _('Benutzername') }}</label>
            </div>
          </div>

          <!--div class="mb-3">
            <label class="form-label">{{ _('Passwort') }}</label>
            <input type="password" name="password" class="form-control" autocomplete="current-password" required>
          </div-->
          <div class="input-group mb-3">
            <span class="input-group-text"><i class="bi bi-key"></i></span>
            <div class="form-floating flex-grow-1">
              <input name="password" type="password" class="form-control" autocomplete="current-password" required>
              <label for="vollgut">{{ _('Passwort') }}</label>
            </div>
          </div>

          <button class="btn btn-primary w-100">{{ _('Login') }}</button>
        </form>

        <!-- "Passwort vergessen?" -->
        <div class="mt-3 text-end">
          <button class="btn btn-link p-0"
                  type="button"
                  data-bs-toggle="modal"
                  data-bs-target="#forgotPwdModal">
            {{ _('Passwort vergessen?') }}
          </button>
        </div>

        <!-- Modal: Passwort zurücksetzen anfordern -->
        <div class="modal fade" id="forgotPwdModal" tabindex="-1" aria-labelledby="forgotPwdLabel" aria-hidden="true">
          <div class="modal-dialog">
            <div class="modal-content">
              <form method="post" action="{{ url_for('auth_routes.request_reset') }}" id="forgotPwdForm" novalidate>
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <div class="modal-header">
                  <h5 class="modal-title" id="forgotPwdLabel">{{ _('Passwort zurücksetzen anfordern') }}</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="{{ _('Schließen') }}"></button>
                </div>
                <div class="modal-body">
                  <div class="input-group mb-3">
                    <span class="input-group-text"><i class="bi bi-person"></i></span>
                    <div class="form-floating flex-grow-1">
                      <input type="text" class="form-control" id="forgot_username" name="username" required>
                      <label for="forgot_username">{{ _('Benutzername') }}</label>
                    </div>
                  </div>
                  <div class="invalid-feedback">{{ _('Bitte Benutzername angeben') }}.</div>
                  <small class="text-muted">
                    {{ _('Wenn die Angaben korrekt sind, wird ein Reset-Link per E-Mail gesendet.') }}
                  </small>
                </div>
                <div class="modal-footer d-flex justify-content-between">
                  <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">{{ _('Abbrechen') }}</button>
                  <button type="submit" class="btn btn-primary">{{ _('Reset-Link senden') }}</button>
                </div>
              </form>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>
</div>

{% block scripts %}
<script>
  // Prefill: Benutzername aus dem Login-Feld ins Modal übernehmen
  document.addEventListener('DOMContentLoaded', () => {
    const modalEl = document.getElementById('forgotPwdModal');
    if (!modalEl) return;
    modalEl.addEventListener('shown.bs.modal', () => {
      const loginUser = document.getElementById('login_username')?.value || '';
      const forgotUser = document.getElementById('forgot_username');
      if (forgotUser) {
        forgotUser.value = loginUser;
        forgotUser.focus();
      }
    });

    // Einfache Client-Validierung
    const form = document.getElementById('forgotPwdForm');
    form?.addEventListener('submit', (e) => {
      if (!form.checkValidity()) {
        e.preventDefault();
        e.stopPropagation();
        form.classList.add('was-validated');
      }
    });

    // Enter-Submit im Modal (nur bei Eingaben)
    modalEl.addEventListener('keydown', (e) => {
      const tag = (e.target.tagName || '').toLowerCase();
      if (e.key === 'Enter' && (tag === 'input' || tag === 'select' || tag === 'textarea')) {
        e.preventDefault();
        form?.requestSubmit();
      }
    });
  });
</script>
{% endblock %}
{% endblock %}